<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="test">
    <!-- æŸ¥è¯¢ -->
    <GetUserInfoParam>
        <field name="name" type="string" ></field>
        <field name="age" type="int32" ></field>
        <field name="state_id" type="int32" ></field>
    </GetUserInfoParam>
    <GetUserInfoEntity>
        <field name="id" type="uint64"></field>
        <field name="name" type="string"></field>
        <field name="age" type="int32" ></field>
        <field name="state_id" type="int32" ></field>
    </GetUserInfoEntity>

    <select id="GetUserInfo" param_type="GetUserInfoParam" result_type="GetUserInfoEntity">
        select `id`,`name`,`age`,`state_id`
        from `user_info`
        where 1 = 1
        <if test="!#{name}.empty()">
            and `name` = #{name}
        </if>
        <if test="#{age} > 0">
            and `age` = #{age}
        </if>
        <if test="#{state_id} > 0">
            and `state_id` = #{state_id}
        </if>
    </select>

    <GetUserInfoByNameParam>
        <field name="name" type="array[string]"></field>
    </GetUserInfoByNameParam>
    <GetUserInfoByNameResult>
        <field name="id" type="uint64"></field>
        <field name="name" type="string"></field>
        <field name="age" type="int32" ></field>
        <field name="state_id" type="int32" ></field>
    </GetUserInfoByNameResult>
    <select id="GetUserInfoByName" param_type="GetUserInfoByNameParam" result_type="GetUserInfoByNameResult">
        <if test="#{name}.size() > 0">
            select `id`,`name`,`age`,`state_id`
            from `user_info`
            where `name` in
            <foreach collection="#{name}" open="(" close =")" separator=","></foreach>
        </if>
    </select>

    <!-- update -->
    <UpdateUserInfoByIdParam>
        <field name="name" type="string" ></field>
        <field name="age" type="int32" ></field>
        <field name="state_id" type="int32"></field>
        <field name="id" type="uint64"></field>
    </UpdateUserInfoByIdParam>

    <update id="UpdateUserInfoById" param_type="UpdateUserInfoByIdParam">
        update `user_info`
        set `id` = `id`
        <if test="!#{name}.empty()">
            ,`name` = #{name}
        </if>
        <if test="#{age} > 0">
            ,`age` = #{age}
        </if>
        <if test="#{state_id} > 0">
            ,`state_id` = #{state_id}
        </if>
        where `id` = #{id}
    </update>

    <!-- insert -->
    <InsertUserParam>
        <field name="name" type="string" ></field>
        <field name="age" type="int32" ></field>
        <field name="state_id" type="int32" ></field>
        <field name="id" type="uint64"></field>
    </InsertUserParam>
    <insert id="AddUser" param_type="InsertUserParam">
        insert into `user_info` (`id`,`name`,`age`,`state_id`)
        values(#{id}, #{name}, #{age}, #{state_id})
    </insert>

    <DeleteUserParam>
        <field name="id" type="uint64"></field>
    </DeleteUserParam>
    <delete id="DeleteUser" param_type="DeleteUserParam">
        delete from `user_info`
        where `id` = #{id}
    </delete>

</mapper>
